# CI Test Compose
# Used by the api-ci.yml workflow to run tests.
# Builds from the 'test' stage of the Dockerfile which includes full source.
#
# Usage:
#   docker compose -f docker-compose.citest.yml up \
#     --exit-code-from adonis_app_test adonis_app_test

services:
  adonis_app_test:
    build:
      context: .
      dockerfile: Dockerfile
      target: test
    command: ['dumb-init', 'node', 'test.js']
    environment:
      - NODE_ENV=test
      - COMMIT_SHA=test-sha
